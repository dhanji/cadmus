# Sieve of Eratosthenes: find all primes up to n
# Example: primes up to 30 = (2 3 5 7 11 13 17 19 23 29)
# expected: (2 3 5 7 11 13 17 19 23 29)

sieve_of_eratosthenes:
  inputs:
    - n: "Number"
  bindings:
    n: "30"
  steps:
    - let_bind:
        bindings: "[sieve (make-vector (+ n 1) #t)]"
        body: "(begin (vector-set! sieve 0 #f) (vector-set! sieve 1 #f) (for ([i (in-range 2 (+ (exact-floor (sqrt n)) 1))]) (when (vector-ref sieve i) (for ([j (in-range (* i i) (+ n 1) i)]) (vector-set! sieve j #f)))) (for/list ([i (in-range 2 (+ n 1))] #:when (vector-ref sieve i)) i))"
