# Consistent hashing: assign keys to nodes on a ring
# 3 nodes at positions 100, 200, 300; key at position 150 â†’ node 200
# expected: 200

consistent_hashing:
  inputs:
    - n: "Number"
  bindings:
    n: "0"
  steps:
    - list_new: "100 200 300"
    - sort_list:
        comparator: "<"
    - fold:
        acc: "result"
        init: "-1"
        var: "node"
        over: "$step-2"
        body:
          - cond:
              clauses:
                - test:
                    and_logic:
                      x:
                        equal:
                          x: "$result"
                          y: "-1"
                      y:
                        greater_than_or_equal:
                          x: "$node"
                          y: "150"
                  then: "$node"
                - else: "$result"
    - cond:
        clauses:
          - test:
              equal:
                x: "$step-3"
                y: "-1"
            then:
              - first_elem: "$step-2"
          - else: "$step-3"
