# MurmurHash3 (simplified 32-bit)
# Example: murmur("hello", seed=42) â€” deterministic hash
# expected: 2384946537

murmurhash3:
  inputs:
    - s: "String"
  bindings:
    s: "\"hello\""
  steps:
    - let_bind:
        bindings: "[seed 42] [c1 3432918353] [c2 461845907] [m 4294967296]"
        body: "(let* ([bytes (map char->integer (string->list s))] [h (for/fold ([h seed]) ([b (in-list bytes)]) (let* ([k (modulo (* b c1) m)] [k (modulo (bitwise-ior (arithmetic-shift k 15) (arithmetic-shift k -17)) m)] [k (modulo (* k c2) m)] [h (bitwise-xor h k)] [h (modulo (bitwise-ior (arithmetic-shift h 13) (arithmetic-shift h -19)) m)] [h (modulo (+ (* h 5) 3864292196) m)]) h))] [h (bitwise-xor h (length bytes))] [h (bitwise-xor h (arithmetic-shift h -16))] [h (modulo (* h 2246822507) m)] [h (bitwise-xor h (arithmetic-shift h -13))] [h (modulo (* h 3266489909) m)] [h (bitwise-xor h (arithmetic-shift h -16))]) (modulo h m))"
