# MurmurHash3 (simplified 32-bit)
# Example: murmur("hello", seed=42) â€” deterministic hash
# expected: 2384946537

murmurhash3:
  inputs:
    - s: "String"
  bindings:
    s: "\"hello\""
  steps:
    - string_to_list: "$s"
    - map:
        var: "c"
        over: "$step-1"
        body:
          - char_to_integer: "$c"
    - fold:
        acc: "h"
        init: "42"
        var: "b"
        over: "$step-2"
        body:
          - multiply:
              x: "$b"
              y: "3432918353"
          - modulo:
              x: "$body-1"
              y: "4294967296"
          - bitwise_or:
              x:
                arithmetic_shift:
                  x: "$body-2"
                  y: "15"
              y:
                arithmetic_shift:
                  x: "$body-2"
                  y: "-17"
          - modulo:
              x: "$body-3"
              y: "4294967296"
          - multiply:
              x: "$body-4"
              y: "461845907"
          - modulo:
              x: "$body-5"
              y: "4294967296"
          - bitwise_xor:
              x: "$h"
              y: "$body-6"
          - bitwise_or:
              x:
                arithmetic_shift:
                  x: "$body-7"
                  y: "13"
              y:
                arithmetic_shift:
                  x: "$body-7"
                  y: "-19"
          - modulo:
              x: "$body-8"
              y: "4294967296"
          - multiply:
              x: "$body-9"
              y: "5"
          - add:
              x: "$body-10"
              y: "3864292196"
          - modulo:
              x: "$body-11"
              y: "4294967296"
    - length: "$step-2"
    - bitwise_xor:
        x: "$step-3"
        y: "$step-4"
    - arithmetic_shift:
        x: "$step-5"
        y: "-16"
    - bitwise_xor:
        x: "$step-5"
        y: "$step-6"
    - multiply:
        x: "$step-7"
        y: "2246822507"
    - modulo:
        x: "$step-8"
        y: "4294967296"
    - arithmetic_shift:
        x: "$step-9"
        y: "-13"
    - bitwise_xor:
        x: "$step-9"
        y: "$step-10"
    - multiply:
        x: "$step-11"
        y: "3266489909"
    - modulo:
        x: "$step-12"
        y: "4294967296"
    - arithmetic_shift:
        x: "$step-13"
        y: "-16"
    - bitwise_xor:
        x: "$step-13"
        y: "$step-14"
    - modulo:
        x: "$step-15"
        y: "4294967296"
