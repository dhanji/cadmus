# CSV column sum: parse CSV rows and sum a numeric column
# Example: sum column 1 of "1,10\n2,20\n3,30" = 60
# expected: 60

csv_column_sum:
  inputs:
    - data: "String"
    - col: "Number"
  bindings:
    data: '"1,10\n2,20\n3,30"'
    col: "1"
  steps:
    - string_split:
        s: "$data"
        delim: '"\n"'
    - for_sum:
        var: "row"
        over: "$step-1"
        body:
          - csv_parse_row:
              row: "$row"
          - list_ref:
              x: "$body-1"
              y: "$col"
          - string_to_number:
              s: "$body-2"
