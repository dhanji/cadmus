# Power set: all subsets of a set
# Example: power_set((1 2 3)) = (() (1) (2) (1 2) (3) (1 3) (2 3) (1 2 3))
# expected: (() (1) (2) (1 2) (3) (1 3) (2 3) (1 2 3))

power_set:
  inputs:
    - lst: "List(Number)"
  bindings:
    lst: "(list 1 2 3)"
  steps:
    - length: "$lst"
    - expt:
        x: "2"
        y: "$step-1"
    - range:
        start: "0"
        end: "$step-2"
    - map:
        var: "mask"
        over: "$step-3"
        body:
          - range:
              start: "0"
              end: "$step-1"
          - fold:
              acc: "subset"
              init: "(list)"
              var: "i"
              over: "$body-1"
              body:
                - arithmetic_shift:
                    x: "1"
                    y: "$i"
                - bitwise_and:
                    x: "$mask"
                    y: "$body-1"
                - cond:
                    clauses:
                      - test:
                          greater_than:
                            x: "$body-2"
                            y: "0"
                        then:
                          - list_ref:
                              x: "$lst"
                              y: "$i"
                          - append:
                              x: "$subset"
                              y:
                                list_new: "$body-1"
                      - else: "$subset"
