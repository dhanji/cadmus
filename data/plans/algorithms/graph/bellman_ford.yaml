# Bellman-Ford: shortest paths with negative edges
# Graph: 0→1(4) 0→2(1) 1→3(1) 2→1(-2) 2→3(5) 3→4(3)
# Example: distances from 0 = (0 -1 1 0 3)
# expected: (0 -1 1 0 3)

bellman_ford:
  inputs:
    - n: "Number"
    - edges: "List(List(Number))"
  bindings:
    n: "5"
    edges: "(list (list 0 1 4) (list 0 2 1) (list 1 3 1) (list 2 1 -2) (list 2 3 5) (list 3 4 3))"
  steps:
    - make_vector:
        size: "$n"
        init: "+inf.0"
    - vector_set:
        v: "$step-1"
        i: "0"
        val: "0"
    - subtract:
        x: "$n"
        y: "1"
    - range:
        start: "0"
        end: "$step-3"
    - for_each:
        var: "_"
        over: "$step-4"
        body:
          - for_each:
              var: "e"
              over: "$edges"
              body:
                - first_elem: "$e"
                - second_elem: "$e"
                - third_elem: "$e"
                - vector_ref:
                    v: "$step-1"
                    i: "$body-1"
                - add:
                    x: "$body-4"
                    y: "$body-3"
                - vector_ref:
                    v: "$step-1"
                    i: "$body-2"
                - when_do:
                    test:
                      less_than:
                        x: "$body-5"
                        y: "$body-6"
                    body:
                      - vector_set:
                          v: "$step-1"
                          i: "$body-2"
                          val: "$body-5"
    - vector_to_list: "$step-1"
