# Topological sort using Kahn's algorithm (BFS-based)
# DAG: 0→1,2  1→3  2→3,4  4→5  3→5
# Example: one valid order = (0 1 2 3 4 5)
# expected: (0 1 2 3 4 5)

topological_sort:
  inputs:
    - n: "Number"
  bindings:
    n: "6"
  steps:
    - let_bind:
        bindings: "[adj (vector (list 1 2) (list 3) (list 3 4) (list 5) (list 5) (list))] [indeg (make-vector 6 0)]"
        body: "(begin (for* ([u (in-range n)] [v (in-list (vector-ref adj u))]) (vector-set! indeg v (+ (vector-ref indeg v) 1))) (let loop ([queue (for/list ([i (in-range n)] #:when (= (vector-ref indeg i) 0)) i)] [result (list)]) (if (null? queue) (reverse result) (let ([u (car queue)]) (let ([queue (for/fold ([q (cdr queue)]) ([v (in-list (vector-ref adj u))]) (vector-set! indeg v (- (vector-ref indeg v) 1)) (if (= (vector-ref indeg v) 0) (append q (list v)) q))]) (loop queue (cons u result)))))))"
