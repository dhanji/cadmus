# Floyd-Warshall: all-pairs shortest paths
# 4 nodes, edges: 0→1(3) 0→2(6) 1→2(2) 2→3(1) 3→0(7)
# Example: dist matrix row 0 = (0 3 5 6)
# expected: (0 3 5 6)

floyd_warshall:
  inputs:
    - n: "Number"
    - d: "Vector(Vector(Number))"
  bindings:
    n: "4"
    d: "(vector (vector 0 3 6 +inf.0) (vector +inf.0 0 2 +inf.0) (vector +inf.0 +inf.0 0 1) (vector 7 +inf.0 +inf.0 0))"
  steps:
    - for_star:
        vars:
          - { var: "k", start: "0", end: "$n" }
          - { var: "i", start: "0", end: "$n" }
          - { var: "j", start: "0", end: "$n" }
        body:
          - vector_ref:
              v: "$d"
              i: "$i"
          - vector_ref:
              v: "$body-1"
              i: "$k"
          - vector_ref:
              v: "$d"
              i: "$k"
          - vector_ref:
              v: "$body-3"
              i: "$j"
          - add:
              x: "$body-2"
              y: "$body-4"
          - vector_ref:
              v: "$body-1"
              i: "$j"
          - when_do:
              test:
                less_than:
                  x: "$body-5"
                  y: "$body-6"
              body:
                - vector_set:
                    v: "$body-1"
                    i: "$j"
                    val: "$body-5"
    - vector_ref:
        v: "$d"
        i: "0"
    - vector_to_list: "$step-2"
