# Prim's MST: minimum spanning tree using greedy approach
# Edges: (0,1,4) (0,2,1) (1,2,2) (1,3,5) (2,3,3)
# MST weight = 1+2+3 = 6
# expected: 6

prim_mst:
  inputs:
    - n: "Number"
    - adj: "Vector(List(Any))"
  bindings:
    n: "4"
    adj: "(vector (list (cons 1 4) (cons 2 1)) (list (cons 0 4) (cons 2 2) (cons 3 5)) (list (cons 0 1) (cons 1 2) (cons 3 3)) (list (cons 1 5) (cons 2 3)))"
  steps:
    - make_vector:
        size: "4"
        init: "#f"
    - make_vector:
        size: "4"
        init: "+inf.0"
    - vector_set:
        v: "$step-2"
        i: "0"
        val: "0"
    - range:
        start: "0"
        end: "$n"
    - for_sum:
        var: "_"
        over: "$step-4"
        body:
          - range:
              start: "0"
              end: "$n"
          - fold:
              acc: "best"
              init: "-1"
              var: "i"
              over: "$body-1"
              body:
                - vector_ref:
                    v: "$step-1"
                    i: "$i"
                - not: "$body-1"
                - cond:
                    clauses:
                      - test: "$body-2"
                        then:
                          - cond:
                              clauses:
                                - test:
                                    equal:
                                      x: "$best"
                                      y: "-1"
                                  then: "$i"
                                - test:
                                    less_than:
                                      x:
                                        vector_ref:
                                          v: "$step-2"
                                          i: "$i"
                                      y:
                                        vector_ref:
                                          v: "$step-2"
                                          i: "$best"
                                  then: "$i"
                                - else: "$best"
                      - else: "$best"
          - vector_set:
              v: "$step-1"
              i: "$body-2"
              val: "#t"
          - vector_ref:
              v: "$adj"
              i: "$body-2"
          - for_each:
              var: "edge"
              over: "$body-4"
              body:
                - car: "$edge"
                - cdr: "$edge"
                - vector_ref:
                    v: "$step-1"
                    i: "$body-1"
                - not: "$body-3"
                - vector_ref:
                    v: "$step-2"
                    i: "$body-1"
                - less_than:
                    x: "$body-2"
                    y: "$body-5"
                - and_logic:
                    x: "$body-4"
                    y: "$body-6"
                - when_do:
                    test: "$body-7"
                    body:
                      - vector_set:
                          v: "$step-2"
                          i: "$body-1"
                          val: "$body-2"
          - vector_ref:
              v: "$step-2"
              i: "$body-2"
