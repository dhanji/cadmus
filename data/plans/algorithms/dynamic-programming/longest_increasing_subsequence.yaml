# Longest increasing subsequence length
# Example: LIS of (10 9 2 5 3 7 101 18) = 4
# expected: 4

longest_increasing_subsequence:
  inputs:
    - lst: "List(Number)"
  bindings:
    lst: "(list 10 9 2 5 3 7 101 18)"
  steps:
    - length: "$lst"
    - make_vector:
        size: "$step-1"
        init: "1"
    - for_range:
        var: "i"
        start: "1"
        end: "$step-1"
        body:
          - for_range:
              var: "j"
              start: "0"
              end: "$i"
              body:
                - list_ref:
                    x: "$lst"
                    y: "$j"
                - list_ref:
                    x: "$lst"
                    y: "$i"
                - when_do:
                    test:
                      less_than:
                        x: "$body-1"
                        y: "$body-2"
                    body:
                      - vector_ref:
                          v: "$step-2"
                          i: "$i"
                      - vector_ref:
                          v: "$step-2"
                          i: "$j"
                      - add:
                          x: "$body-2"
                          y: "1"
                      - max:
                          x: "$body-1"
                          y: "$body-3"
                      - vector_set:
                          v: "$step-2"
                          i: "$i"
                          val: "$body-4"
    - range:
        start: "0"
        end: "$step-1"
    - fold:
        acc: "mx"
        init: "0"
        var: "i"
        over: "$step-4"
        body:
          - vector_ref:
              v: "$step-2"
              i: "$i"
          - max:
              x: "$mx"
              y: "$body-1"
