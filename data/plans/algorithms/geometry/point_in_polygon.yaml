# Point in polygon: ray casting algorithm
# Example: point (1,1) in square (0,0)(4,0)(4,4)(0,4) = #t
# expected: #t

point_in_polygon:
  inputs:
    - n: "Number"
  bindings:
    n: "4"
  steps:
    - vector_new: "0 4 4 0"
    - vector_new: "0 0 4 4"
    - range:
        start: "0"
        end: "$n"
    - for_sum:
        var: "i"
        over: "$step-3"
        body:
          - add:
              x: "$i"
              y: "1"
          - modulo:
              x: "$body-1"
              y: "$n"
          - vector_ref:
              v: "$step-1"
              i: "$i"
          - vector_ref:
              v: "$step-2"
              i: "$i"
          - vector_ref:
              v: "$step-1"
              i: "$body-2"
          - vector_ref:
              v: "$step-2"
              i: "$body-2"
          - cond:
              clauses:
                - test:
                    and_logic:
                      x:
                        or_logic:
                          x:
                            and_logic:
                              x:
                                less_than_or_equal:
                                  x: "$body-4"
                                  y: "1"
                              y:
                                greater_than:
                                  x: "$body-6"
                                  y: "1"
                          y:
                            and_logic:
                              x:
                                less_than_or_equal:
                                  x: "$body-6"
                                  y: "1"
                              y:
                                greater_than:
                                  x: "$body-4"
                                  y: "1"
                      y:
                        less_than:
                          x: "1"
                          y:
                            add:
                              x: "$body-3"
                              y:
                                divide:
                                  x:
                                    multiply:
                                      x:
                                        subtract:
                                          x: "1"
                                          y: "$body-4"
                                      y:
                                        subtract:
                                          x: "$body-5"
                                          y: "$body-3"
                                  y:
                                    subtract:
                                      x: "$body-6"
                                      y: "$body-4"
                  then: "1"
                - else: "0"
    - odd_check: "$step-4"
