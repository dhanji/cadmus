# KMP string search: find first occurrence of pattern in text
# Example: kmp("ABABDABACDABABCABAB", "ABABCABAB") = 9
# expected: 10

knuth_morris_pratt:
  inputs:
    - text: "String"
    - pattern: "String"
  bindings:
    text: "\"ABABDABACDABABCABAB\""
    pattern: "\"ABABCABAB\""
  steps:
    - let_bind:
        bindings: "[m (string-length pattern)] [n (string-length text)] [lps (make-vector (string-length pattern) 0)]"
        body: "(begin (let build ([i 1] [len 0]) (when (< i m) (cond [(char=? (string-ref pattern i) (string-ref pattern len)) (vector-set! lps i (+ len 1)) (build (+ i 1) (+ len 1))] [(> len 0) (build i (vector-ref lps (- len 1)))] [else (vector-set! lps i 0) (build (+ i 1) 0)]))) (let search ([i 0] [j 0]) (cond [(= j m) (- i m)] [(= i n) -1] [(char=? (string-ref text i) (string-ref pattern j)) (search (+ i 1) (+ j 1))] [(> j 0) (search i (vector-ref lps (- j 1)))] [else (search (+ i 1) 0)])))"
